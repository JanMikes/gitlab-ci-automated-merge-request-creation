stages:
  - merge-request

create mr:
  stage: merge-request
  variables:
    GIT_STRATEGY: clone
  rules:
      - if: $CI_OPEN_MERGE_REQUESTS == null
  before_script:
      # Install jq (https://stedolan.github.io/jq/download/)
      - apt-get update -y && apt-get install -y jq
  script:
      # Determine parent branch
      - echo $CI_PRE_CLONE_SCRIPT
      - git fetch --all
      - git show-branch -a
      - parent_branch=$(git show-branch --remote | sed "s/].*//" | grep "\+ \[" | grep -v "$(git rev-parse --abbrev-ref HEAD)" | head -n1 | sed "s/^.*\[origin\///")
      - echo $parent_branch
